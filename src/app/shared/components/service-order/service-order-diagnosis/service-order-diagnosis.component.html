<div class="diagnosis-container">
    <div class="border-b border-gray-200 pb-3 mb-4">
        <h3 class="text-lg font-medium text-gray-800">2. Diagnóstico e Orçamento</h3>
        <p class="text-sm text-gray-500">Registre os problemas identificados, peças necessárias e serviços a realizar
        </p>
    </div>

    <fieldset>
        <legend class="text-lg font-medium text-gray-700 mb-3 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-[#EC9253]" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            Diagnóstico
        </legend>
        <div>
            <label class="block text-gray-700 mb-1">Problemas Identificados</label>
            <textarea [ngModel]="getProblemsText()" (ngModelChange)="setProblemsText($event)" [readonly]="readonly"
                rows="4"
                class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-[#EC9253] focus:outline-none focus:border-[#EC9253]"
                [ngClass]="{'bg-gray-100': readonly}"
                placeholder="Descreva os problemas identificados durante o diagnóstico...">
            </textarea>
        </div>
    </fieldset>

    <fieldset class="mt-6">
        <legend class="text-lg font-medium text-gray-700 mb-3 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-[#EC9253]" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
            Peças Necessárias
        </legend>
        <div>
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col"
                            class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-6/12">
                            Peça</th>
                        <th scope="col"
                            class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-2/12">
                            Qtd
                        </th>
                        <th scope="col"
                            class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-2/12">
                            Preço
                            Unit.</th>
                        <th scope="col"
                            class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-2/12">
                            Total
                        </th>
                        <th scope="col"
                            class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                            *ngIf="!readonly"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngIf="!serviceOrderData.requiredParts || serviceOrderData.requiredParts.length === 0">
                        <td colspan="5" class="px-4 py-2 text-sm text-gray-500 text-center">Nenhuma peça adicionada</td>
                    </tr>
                    <tr *ngFor="let part of serviceOrderData.requiredParts || []; let i = index" class="bg-white">
                        <td class="px-4 py-2">
                            <app-part-dropdown [selectedPartId]="part.partId" [selectedPartName]="part.description"
                                [disabled]="readonly" (partSelected)="onPartSelected($event, i)" class="part-dropdown">
                            </app-part-dropdown>
                        </td>
                        <td class="px-4 py-2">
                            <input type="number" [(ngModel)]="part.quantity" [name]="'part_qty_' + i" min="1"
                                [readonly]="readonly"
                                class="w-full border border-gray-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-[#EC9253] focus:outline-none focus:border-[#EC9253] text-gray-900"
                                [ngClass]="{'bg-gray-100 cursor-not-allowed': readonly}"
                                (change)="updatePartTotalPrice(part)" />
                        </td>
                        <td class="px-4 py-2">
                            <input type="text"
                                class="w-full border border-gray-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-[#EC9253] focus:outline-none text-gray-900"
                                [(ngModel)]="part.formattedUnitPrice"
                                (ngModelChange)="onUnitPriceKeypress(part, $event)" placeholder="0,00"
                                [readonly]="readonly" [ngClass]="{'bg-gray-100': readonly}">
                        </td>
                        <td class="px-4 py-2 text-sm font-medium">R$ {{ formatCurrency(part.totalPrice) }}</td>
                        <td class="px-4 py-2" *ngIf="!readonly">
                            <button type="button" (click)="removeRequiredPart(i)"
                                class="text-red-500 hover:text-red-700">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <button *ngIf="!readonly" type="button" (click)="addRequiredPart()"
            class="mt-2 text-sm text-[#EC9253] hover:text-[#f78839] flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            Adicionar peça
        </button>
    </fieldset>

    <fieldset class="mt-6">
        <legend class="text-lg font-medium text-gray-700 mb-3 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-[#EC9253]" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            Serviços a Realizar
        </legend>
        <div>
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col"
                            class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-6/12">
                            Serviço</th>
                        <th scope="col"
                            class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-2/12">
                            Horas
                        </th>
                        <th scope="col"
                            class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-2/12">
                            Preço/H</th>
                        <th scope="col"
                            class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-2/12">
                            Total
                        </th>
                        <th scope="col"
                            class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                            *ngIf="!readonly"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngIf="!serviceOrderData.services || serviceOrderData.services.length === 0">
                        <td colspan="5" class="px-4 py-2 text-sm text-gray-500 text-center">Nenhum serviço adicionado
                        </td>
                    </tr>
                    <tr *ngFor="let service of serviceOrderData.services || []; let i = index" class="bg-white">
                        <td class="px-4 py-2">
                            <app-service-dropdown [selectedServiceId]="service.serviceId"
                                [selectedServiceName]="service.description" [disabled]="readonly"
                                (serviceSelected)="onServiceSelected($event, i)" class="service-dropdown">
                            </app-service-dropdown>
                        </td>
                        <td class="px-4 py-2">
                            <input type="number" [(ngModel)]="service.estimatedHours" [name]="'service_hours_' + i"
                                min="0.5" step="0.5" [readonly]="readonly"
                                class="w-full border border-gray-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-[#EC9253] focus:outline-none focus:border-[#EC9253] text-gray-900"
                                [ngClass]="{'bg-gray-100 cursor-not-allowed': readonly}"
                                (change)="updateServiceTotalPrice(service)" />
                        </td>
                        <td class="px-4 py-2">
                            <input type="text"
                                class="w-full border border-gray-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-[#EC9253] focus:outline-none text-gray-900"
                                [(ngModel)]="service.formattedPricePerHour"
                                (ngModelChange)="onPricePerHourKeypress(service, $event)" placeholder="0,00"
                                [readonly]="readonly" [ngClass]="{'bg-gray-100': readonly}">
                        </td>
                        <td class="px-4 py-2 text-sm font-medium">R$ {{ formatCurrency(service.totalPrice) }}</td>
                        <td class="px-4 py-2" *ngIf="!readonly">
                            <button type="button" (click)="removeService(i)" class="text-red-500 hover:text-red-700">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <button *ngIf="!readonly" type="button" (click)="addService()"
            class="mt-2 text-sm text-[#EC9253] hover:text-[#f78839] flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            Adicionar serviço
        </button>
    </fieldset>

    <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
            <label class="block text-gray-700 mb-1">Previsão de Conclusão <span class="text-red-500">*</span></label>
            <input type="date" [(ngModel)]="serviceOrderData.estimatedCompletionDate" name="estimatedCompletionDate"
                [disabled]="readonly"
                class="w-full h-12 border rounded-lg p-2 focus:ring-2 focus:outline-none transition duration-200 text-gray-900"
                [ngClass]="{
                    'bg-gray-100 cursor-not-allowed': readonly,
                    'border-red-500 focus:ring-red-500 focus:border-red-500': estimatedCompletionDateError,
                    'border-gray-300 focus:ring-[#EC9253] focus:border-[#EC9253]': !estimatedCompletionDateError
                }"
                (change)="onEstimatedCompletionDateChange()" />
            <div *ngIf="estimatedCompletionDateError" class="text-red-500 text-sm mt-1">
                O campo 'Previsão de Conclusão' é obrigatório para gerar o orçamento.
            </div>
        </div>
        <div class="md:col-span-2">
            <label class="block text-gray-700 mb-1">Observações Técnicas</label>
            <textarea [(ngModel)]="serviceOrderData.technicalObservations" name="technicalObservations"
                [readonly]="readonly" rows="3"
                class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-[#EC9253] focus:outline-none focus:border-[#EC9253] text-gray-900"
                [ngClass]="{'bg-gray-100 cursor-not-allowed': readonly}"
                placeholder="Observações adicionais sobre o diagnóstico..."></textarea>
        </div>
    </div>

    <div class="mt-6 bg-gray-50 p-4 rounded-lg">
        <h3 class="text-lg font-medium text-gray-700 mb-3">Resumo do Orçamento</h3>

        <div *ngIf="serviceOrderData.status === ServiceOrderStatus.WAITING_APPROVAL || serviceOrderData.status === ServiceOrderStatus.APPROVED"
            class="budget-summary mb-4">
            <div class="bg-gray-50 p-3 rounded-md">
                <div class="flex justify-between text-sm mb-1">
                    <span class="text-gray-600">Nº OS:</span>
                    <span class="font-medium">{{ serviceOrderData.orderNumber }}</span>
                </div>
                <div class="flex justify-between text-sm mb-1">
                    <span class="text-gray-600">Cliente:</span>
                    <span class="font-medium">{{ selectedClientName }}</span>
                </div>
                <div class="flex justify-between text-sm mb-1">
                    <span class="text-gray-600">Veículo:</span>
                    <span class="font-medium">{{serviceOrderData.vehicle?.licensePlate }} - {{
                        serviceOrderData.vehicle?.brandModel }}</span>
                </div>
            </div>
        </div>

        <div class="flex justify-between mb-2">
            <span class="text-gray-600">Total em Peças:</span>
            <span class="font-medium">R$ {{ formatCurrency(serviceOrderData.estimatedTotalParts) }}</span>
        </div>
        <div class="flex justify-between mb-2">
            <span class="text-gray-600">Total em Serviços:</span>
            <span class="font-medium">R$ {{ formatCurrency(serviceOrderData.estimatedTotalServices) }}</span>
        </div>
        <div class="flex justify-between pt-2 border-t border-gray-200">
            <span class="text-gray-700 font-medium">Valor Total:</span>
            <span class="text-lg font-bold text-[#EC9253]">R$ {{ formatCurrency(serviceOrderData.estimatedTotal)
                }}</span>
        </div>
    </div>

    <div *ngIf="serviceOrderData.status === ServiceOrderStatus.WAITING_APPROVAL && !readonly && approvalLink"
        class="mt-6 border-t border-gray-200 pt-4">
        <h3 class="text-lg font-medium text-gray-700 mb-3 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-[#EC9253]" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
            </svg>
            Compartilhar Orçamento
        </h3>

        <div class="sharing-methods mb-4">
            <h4 class="text-sm font-medium text-gray-700 mb-2">Escolha como compartilhar</h4>
            <div class="flex space-x-2">
                <button type="button" [class.active]="shareMethod === 'copy'" (click)="shareMethod = 'copy'"
                    class="share-method-button">
                    <svg class="h-5 w-5 mr-1" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                    </svg>
                    Copiar Link
                </button>
                <button type="button" [class.active]="shareMethod === 'whatsapp'" (click)="shareMethod = 'whatsapp'"
                    class="share-method-button">
                    <svg class="h-5 w-5 mr-1" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M17.498 14.382c-.301-.15-1.767-.867-2.04-.966-.273-.101-.473-.15-.673.15-.197.295-.771.964-.944 1.162-.175.195-.349.21-.646.075-.3-.15-1.263-.465-2.403-1.485-.888-.795-1.484-1.77-1.66-2.07-.174-.3-.019-.465.13-.615.136-.135.301-.345.451-.523.146-.181.194-.301.297-.496.1-.21.049-.39-.025-.54-.075-.15-.672-1.62-.922-2.206-.24-.584-.487-.51-.672-.51-.172-.015-.371-.015-.571-.015-.2 0-.523.074-.797.359-.273.3-1.045 1.02-1.045 2.475s1.07 2.865 1.219 3.075c.149.195 2.105 3.195 5.1 4.485.714.3 1.27.48 1.704.629.714.227 1.365.195 1.88.121.574-.091 1.767-.721 2.016-1.426.255-.705.255-1.29.18-1.425-.074-.135-.27-.21-.57-.345m-5.446 7.443h-.016c-1.77 0-3.524-.48-5.055-1.38l-.36-.214-3.75.975 1.005-3.645-.239-.375c-.99-1.576-1.516-3.391-1.516-5.26 0-5.445 4.455-9.885 9.942-9.885 2.654 0 5.145 1.035 7.021 2.91 1.875 1.859 2.909 4.35 2.909 6.99-.004 5.444-4.46 9.885-9.935 9.885M20.52 3.449C18.24 1.245 15.24 0 12.045 0 5.463 0 .104 5.334.101 11.893c0 2.096.549 4.14 1.595 5.945L0 24l6.335-1.652c1.746.943 3.71 1.444 5.71 1.447h.006c6.585 0 11.946-5.336 11.949-11.896 0-3.176-1.24-6.165-3.495-8.411" />
                    </svg>
                    WhatsApp
                </button>
                <button type="button" [class.active]="shareMethod === 'email'" (click)="shareMethod = 'email'"
                    class="share-method-button">
                    <svg class="h-5 w-5 mr-1" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z" />
                    </svg>
                    Email
                </button>
                <button type="button" [class.active]="shareMethod === 'print'" (click)="shareMethod = 'print'"
                    class="share-method-button">
                    <svg class="h-5 w-5 mr-1" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z" />
                    </svg>
                    Imprimir
                </button>
            </div>
        </div>

        <div *ngIf="shareMethod === 'whatsapp'" class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Número do WhatsApp</label>
            <input type="tel" [(ngModel)]="recipientPhone"
                class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-[#EC9253] focus:outline-none text-gray-900"
                placeholder="Ex: (11) 98765-4321">
        </div>

        <div *ngIf="shareMethod === 'email'" class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Email do Cliente</label>
            <input type="email" [(ngModel)]="recipientEmail"
                class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-[#EC9253] focus:outline-none text-gray-900"
                placeholder="Ex: cliente@email.com">
        </div>

        <div *ngIf="shareMethod === 'copy'" class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Link de Aprovação</label>
            <div class="flex flex-col">
                <div class="flex">
                    <input type="text" [value]="approvalLink" readonly
                        class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-[#EC9253] focus:outline-none bg-gray-50 text-gray-900" />
                </div>
                <div *ngIf="linkCopied" class="text-sm text-green-600 mt-1 ml-2">Link copiado com sucesso!</div>
            </div>
        </div>

        <div *ngIf="shareMethod === 'print'" class="mb-4">
            <p class="text-sm text-gray-600">Clique no botão abaixo para imprimir o orçamento.</p>
        </div>

        <div *ngIf="shareMethod !== 'copy' && shareMethod !== 'print'" class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Mensagem</label>
            <textarea [(ngModel)]="customMessage" rows="5"
                class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-[#EC9253] focus:outline-none text-gray-900"></textarea>
        </div>

        <div class="flex justify-end space-x-2 mt-4">
            <button *ngIf="shareMethod === 'whatsapp'" type="button" (click)="shareViaWhatsApp()"
                class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                <svg class="h-5 w-5 mr-1" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M17.498 14.382c-.301-.15-1.767-.867-2.04-.966-.273-.101-.473-.15-.673.15-.197.295-.771.964-.944 1.162-.175.195-.349.21-.646.075-.3-.15-1.263-.465-2.403-1.485-.888-.795-1.484-1.77-1.66-2.07-.174-.3-.019-.465.13-.615.136-.135.301-.345.451-.523.146-.181.194-.301.297-.496.1-.21.049-.39-.025-.54-.075-.15-.672-1.62-.922-2.206-.24-.584-.487-.51-.672-.51-.172-.015-.371-.015-.571-.015-.2 0-.523.074-.797.359-.273.3-1.045 1.02-1.045 2.475s1.07 2.865 1.219 3.075c.149.195 2.105 3.195 5.1 4.485.714.3 1.27.48 1.704.629.714.227 1.365.195 1.88.121.574-.091 1.767-.721 2.016-1.426.255-.705.255-1.29.18-1.425-.074-.135-.27-.21-.57-.345m-5.446 7.443h-.016c-1.77 0-3.524-.48-5.055-1.38l-.36-.214-3.75.975 1.005-3.645-.239-.375c-.99-1.576-1.516-3.391-1.516-5.26 0-5.445 4.455-9.885 9.942-9.885 2.654 0 5.145 1.035 7.021 2.91 1.875 1.859 2.909 4.35 2.909 6.99-.004 5.444-4.46 9.885-9.935 9.885M20.52 3.449C18.24 1.245 15.24 0 12.045 0 5.463 0 .104 5.334.101 11.893c0 2.096.549 4.14 1.595 5.945L0 24l6.335-1.652c1.746.943 3.71 1.444 5.71 1.447h.006c6.585 0 11.946-5.336 11.949-11.896 0-3.176-1.24-6.165-3.495-8.411" />
                </svg>
                Enviar via WhatsApp
            </button>

            <button *ngIf="shareMethod === 'email'" type="button" (click)="shareViaEmail()"
                class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                <svg class="h-5 w-5 mr-1" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z" />
                </svg>
                Enviar via Email
            </button>

            <button *ngIf="shareMethod === 'copy'" type="button" (click)="copyLinkToClipboard()"
                class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gray-600 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                <svg class="h-5 w-5 mr-1" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                </svg>
                Copiar Link
            </button>

            <button *ngIf="shareMethod === 'print'" type="button" (click)="printBudget()"
                class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500">
                <svg class="h-5 w-5 mr-1" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z" />
                </svg>
                Imprimir
            </button>
        </div>
    </div>

    <div *ngIf="serviceOrderData.status === ServiceOrderStatus.OPENED && !readonly" class="mt-6 flex justify-end">
        <button type="button"
            class="text-sm bg-[#EC9253] text-white px-4 py-2 rounded-lg hover:bg-[#f78839] font-medium transition duration-200"
            (click)="startDiagnosis()">
            Iniciar Diagnóstico
        </button>
    </div>
</div>