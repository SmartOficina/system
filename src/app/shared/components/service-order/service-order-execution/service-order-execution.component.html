<div class="execution-container">
    <div class="border-b border-gray-200 pb-3 mb-4">
        <h3 class="text-lg font-medium text-gray-800">3. Execução do Serviço</h3>
        <p class="text-sm text-gray-500">Acompanhe e atualize o progresso da ordem de serviço</p>
    </div>

    <div class="bg-yellow-50 p-4 rounded-lg mb-6 flex items-start"
        *ngIf="serviceOrderData.status === ServiceOrderStatus.APPROVED && !readonly">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-500 mr-2 flex-shrink-0" fill="none"
            viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
        </svg>
        <div>
            <p class="text-yellow-700 font-medium">Orçamento aprovado</p>
            <p class="text-yellow-600 text-sm">Você pode iniciar a execução do serviço agora.</p>
        </div>
    </div>

    <div class="bg-orange-50 p-4 rounded-lg mb-6 flex items-start"
        *ngIf="serviceOrderData.status === ServiceOrderStatus.WAITING_PARTS && !readonly">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-orange-500 mr-2 flex-shrink-0" fill="none"
            viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
        </svg>
        <div>
            <p class="text-orange-700 font-medium">Aguardando peças</p>
            <p class="text-orange-600 text-sm">O serviço está pausado aguardando a chegada de peças. Você poderá retomar
                a execução quando as peças estiverem disponíveis.</p>
        </div>
    </div>

    <fieldset>
        <legend class="text-lg font-medium text-gray-700 mb-3 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-[#EC9253]" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
            </svg>
            Histórico de Status
        </legend>
        <div class="overflow-y-auto max-h-48 border border-gray-200 rounded-lg">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50 sticky top-0">
                    <tr>
                        <th scope="col"
                            class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data
                        </th>
                        <th scope="col"
                            class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Status</th>
                        <th scope="col"
                            class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Observações</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    <tr *ngIf="!serviceOrderData.statusHistory || serviceOrderData.statusHistory.length === 0">
                        <td colspan="3" class="px-4 py-2 text-sm text-gray-500 text-center">Nenhum registro de status
                        </td>
                    </tr>
                    <tr *ngFor="let statusItem of serviceOrderData.statusHistory">
                        <td class="px-4 py-2 text-sm text-gray-500">{{ statusItem.date | date:'dd/MM/yyyy HH:mm' }}</td>
                        <td class="px-4 py-2">
                            <span class="px-2 py-1 text-xs font-medium rounded-full"
                                [ngClass]="getStatusClass(statusItem.status)">
                                {{ getStatusLabel(statusItem.status) }}
                            </span>
                        </td>
                        <td class="px-4 py-2 text-sm text-gray-500">{{ statusItem.notes }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </fieldset>

    <fieldset class="mt-6">
        <legend class="text-lg font-medium text-gray-700 mb-3 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-[#EC9253]" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
            </svg>
            Atualização Manual de Status
        </legend>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" *ngIf="!readonly">
            <div>
                <label class="block text-gray-700 mb-1">Novo Status</label>
                <select [(ngModel)]="manualStatus" name="manualStatus"
                    class="w-full h-12 border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-[#EC9253] focus:outline-none focus:border-[#EC9253] bg-white">
                    <option value="">Selecione um status</option>
                    <option *ngFor="let option of statusOptions" [value]="option.value">{{ option.label }}</option>
                </select>
            </div>
            <div>
                <label class="block text-gray-700 mb-1">Observações sobre a mudança</label>
                <input type="text" [(ngModel)]="manualStatusNotes" name="manualStatusNotes"
                    class="w-full h-12 border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-[#EC9253] focus:outline-none focus:border-[#EC9253]"
                    placeholder="Motivo da alteração de status" />
            </div>
            <div class="md:col-span-2">
                <button type="button" (click)="manualUpdateStatus()"
                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50"
                    [disabled]="!manualStatus">
                    Atualizar Status
                </button>
            </div>
        </div>
        <div *ngIf="readonly" class="text-gray-500 text-sm italic">
            Para atualizar o status, saia do modo de visualização.
        </div>
    </fieldset>
</div>