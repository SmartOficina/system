<div class="budget-share-modal-backdrop" *ngIf="isVisible" (click)="hide()"></div>

<div class="budget-share-modal" *ngIf="isVisible">
  <div class="budget-share-modal-content" #modalContainer (click)="$event.stopPropagation()">
    <div class="budget-share-modal-header">
      <h3 class="text-lg font-bold text-gray-800">Compartilhar Orçamento</h3>
      <button type="button" (click)="hide()" class="text-gray-400 hover:text-gray-600">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <div class="budget-share-modal-body">
      <div class="budget-summary mb-4">
        <h4 class="text-sm font-medium text-gray-700 mb-2">Resumo do Orçamento</h4>
        <div class="bg-gray-50 p-3 rounded-md">
          <div class="flex justify-between text-sm mb-1">
            <span class="text-gray-600">Nº OS:</span>
            <span class="font-medium">{{ serviceOrderData.orderNumber }}</span>
          </div>
          <div class="flex justify-between text-sm mb-1">
            <span class="text-gray-600">Cliente:</span>
            <span class="font-medium">{{ selectedClientName }}</span>
          </div>
          <div class="flex justify-between text-sm mb-1">
            <span class="text-gray-600">Veículo:</span>
            <span class="font-medium">{{ serviceOrderData.vehicle?.licensePlate }}</span>
          </div>
          <div class="flex justify-between text-sm mb-1">
            <span class="text-gray-600">Total do Orçamento:</span>
            <span class="font-medium text-[#EC9253]">{{ formattedTotal }}</span>
          </div>
        </div>
      </div>

      <div class="sharing-methods mb-4">
        <h4 class="text-sm font-medium text-gray-700 mb-2">Escolha como compartilhar</h4>
        <div class="flex space-x-2">
          <button type="button" [class.active]="shareMethod === 'whatsapp'" (click)="shareMethod = 'whatsapp'"
            class="share-method-button">
            <svg class="h-5 w-5 mr-1" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M17.498 14.382c-.301-.15-1.767-.867-2.04-.966-.273-.101-.473-.15-.673.15-.197.295-.771.964-.944 1.162-.175.195-.349.21-.646.075-.3-.15-1.263-.465-2.403-1.485-.888-.795-1.484-1.77-1.66-2.07-.174-.3-.019-.465.13-.615.136-.135.301-.345.451-.523.146-.181.194-.301.297-.496.1-.21.049-.39-.025-.54-.075-.15-.672-1.62-.922-2.206-.24-.584-.487-.51-.672-.51-.172-.015-.371-.015-.571-.015-.2 0-.523.074-.797.359-.273.3-1.045 1.02-1.045 2.475s1.07 2.865 1.219 3.075c.149.195 2.105 3.195 5.1 4.485.714.3 1.27.48 1.704.629.714.227 1.365.195 1.88.121.574-.091 1.767-.721 2.016-1.426.255-.705.255-1.29.18-1.425-.074-.135-.27-.21-.57-.345m-5.446 7.443h-.016c-1.77 0-3.524-.48-5.055-1.38l-.36-.214-3.75.975 1.005-3.645-.239-.375c-.99-1.576-1.516-3.391-1.516-5.26 0-5.445 4.455-9.885 9.942-9.885 2.654 0 5.145 1.035 7.021 2.91 1.875 1.859 2.909 4.35 2.909 6.99-.004 5.444-4.46 9.885-9.935 9.885M20.52 3.449C18.24 1.245 15.24 0 12.045 0 5.463 0 .104 5.334.101 11.893c0 2.096.549 4.14 1.595 5.945L0 24l6.335-1.652c1.746.943 3.71 1.444 5.71 1.447h.006c6.585 0 11.946-5.336 11.949-11.896 0-3.176-1.24-6.165-3.495-8.411" />
            </svg>
            WhatsApp
          </button>
          <button type="button" [class.active]="shareMethod === 'email'" (click)="shareMethod = 'email'"
            class="share-method-button">
            <svg class="h-5 w-5 mr-1" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z" />
            </svg>
            Email
          </button>
          <button type="button" [class.active]="shareMethod === 'copy'" (click)="shareMethod = 'copy'"
            class="share-method-button">
            <svg class="h-5 w-5 mr-1" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
            </svg>
            Copiar Link
          </button>
        </div>
      </div>

      <div *ngIf="shareMethod === 'whatsapp'" class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-1">Número do WhatsApp</label>
        <input type="tel" [(ngModel)]="recipientPhone" class="input-field" placeholder="Ex: (11) 98765-4321">
      </div>

      <div *ngIf="shareMethod === 'email'" class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-1">Email do Cliente</label>
        <input type="email" [(ngModel)]="recipientEmail" class="input-field" placeholder="Ex: cliente@email.com">
      </div>

      <div *ngIf="shareMethod === 'copy'" class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-1">Link de Aprovação</label>
        <div class="flex">
          <input type="text" [value]="approvalLink" readonly class="input-field flex-grow" />
        </div>
      </div>

      <div *ngIf="shareMethod !== 'copy'" class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-1">Mensagem</label>
        <textarea [(ngModel)]="customMessage" rows="5" class="input-field"></textarea>
      </div>
    </div>

    <div class="budget-share-modal-footer">
      <button type="button" (click)="hide()" class="btn-cancel">Cancelar</button>

      <button *ngIf="shareMethod === 'whatsapp'" type="button" (click)="shareViaWhatsApp()" class="btn-whatsapp">
        <svg class="h-5 w-5 mr-1" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M17.498 14.382c-.301-.15-1.767-.867-2.04-.966-.273-.101-.473-.15-.673.15-.197.295-.771.964-.944 1.162-.175.195-.349.21-.646.075-.3-.15-1.263-.465-2.403-1.485-.888-.795-1.484-1.77-1.66-2.07-.174-.3-.019-.465.13-.615.136-.135.301-.345.451-.523.146-.181.194-.301.297-.496.1-.21.049-.39-.025-.54-.075-.15-.672-1.62-.922-2.206-.24-.584-.487-.51-.672-.51-.172-.015-.371-.015-.571-.015-.2 0-.523.074-.797.359-.273.3-1.045 1.02-1.045 2.475s1.07 2.865 1.219 3.075c.149.195 2.105 3.195 5.1 4.485.714.3 1.27.48 1.704.629.714.227 1.365.195 1.88.121.574-.091 1.767-.721 2.016-1.426.255-.705.255-1.29.18-1.425-.074-.135-.27-.21-.57-.345m-5.446 7.443h-.016c-1.77 0-3.524-.48-5.055-1.38l-.36-.214-3.75.975 1.005-3.645-.239-.375c-.99-1.576-1.516-3.391-1.516-5.26 0-5.445 4.455-9.885 9.942-9.885 2.654 0 5.145 1.035 7.021 2.91 1.875 1.859 2.909 4.35 2.909 6.99-.004 5.444-4.46 9.885-9.935 9.885M20.52 3.449C18.24 1.245 15.24 0 12.045 0 5.463 0 .104 5.334.101 11.893c0 2.096.549 4.14 1.595 5.945L0 24l6.335-1.652c1.746.943 3.71 1.444 5.71 1.447h.006c6.585 0 11.946-5.336 11.949-11.896 0-3.176-1.24-6.165-3.495-8.411" />
        </svg>
        Enviar via WhatsApp
      </button>

      <button *ngIf="shareMethod === 'email'" type="button" (click)="shareViaEmail()" class="btn-email">
        <svg class="h-5 w-5 mr-1" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z" />
        </svg>
        Enviar via Email
      </button>

      <button *ngIf="shareMethod === 'copy'" type="button" (click)="copyLinkToClipboard()" class="btn-copy">
        <svg class="h-5 w-5 mr-1" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
        </svg>
        Copiar Link
      </button>
    </div>
  </div>
</div>